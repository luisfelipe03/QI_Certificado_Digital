<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificados Pessoa Física</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <button id="btn-home">Voltar</button>
    </header>

    <h1>Certificados Pessoa Física</h1>

    <ul id="certificados-list">
        <!-- Certificados serão carregados aqui dinamicamente -->
    </ul>
    
    <h2>Adicionar Novo Certificado</h2>
    <form id="form-upload" enctype="multipart/form-data">
        <label for="arquivoPfx">Arquivo PFX:</label>
        <input type="file" id="arquivoPfx" name="arquivoPfx" required style="margin-bottom: 10px; display: block; width: calc(100% - 20px);">
        <label for="senha">Senha:</label>
        <input type="password" id="senha" name="senha" required style="margin-bottom: 10px; display: block; width: calc(100% - 20px);">
        <button type="submit" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; width: calc(100% - 20px);">Enviar</button>
    </form>

    <div id="mensagem"></div>

    <script>
        const baseUrl = "http://localhost:8080/api/certificado-pf";

        $(document).ready(function() {
            // Estilizando a página
            $("body").css("font-family", "Arial, sans-serif");
            $("header").css({
                "background-color": "#f0f0f0",
                "padding": "10px",
                "text-align": "center"
            });
            $("header button").css({
                "background-color": "transparent",
                "color": "#555",
                "border": "none",
                "padding": "5px 10px",
                "font-size": "14px",
                "cursor": "pointer"
            });
            $("h1").css({
                "text-align": "center",
                "color": "#333"
            });
            $("h2").css({
                "margin-top": "20px"
            });
            $("form").css({
                "margin-bottom": "20px"
            });
            $("input[type=file], input[type=password], button[type=submit]").css({
                "box-sizing": "border-box"
            });
            $("button[type=submit]").css({
                "background-color": "#4CAF50",
                "color": "white",
                "padding": "10px 20px",
                "border": "none",
                "border-radius": "4px",
                "cursor": "pointer"
            });
            $("button[type=submit]:hover").css({
                "background-color": "#45a049"
            });
            $("#btn-home").click(function() {
                window.location.href = "./home.html";
            });
        });

        


        document.getElementById("form-upload").addEventListener("submit", function(event) {
            event.preventDefault();
            var arquivoPfx = document.getElementById("arquivoPfx").files[0];
            var senha = document.getElementById("senha").value;
            
            var formData = new FormData();
            formData.append("certificado", arquivoPfx);
            formData.append("senha", senha);

            fetch(`${baseUrl}/upload`, {
                method: "POST",
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao enviar certificado: " + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                carregarCertificados();
                exibirMensagem("Certificado enviado com sucesso!", "success");
                limparCampos();
            })
            .catch(error => {
                if (error instanceof SyntaxError) {
                    exibirMensagem("Erro ao processar o certificado: " + error.message, "error");
                } else {
                    exibirMensagem("Erro: " + error.message, "error");
                }
            });
        });

        function carregarCertificados() {
            fetch(baseUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao carregar certificados: " + response.statusText);
                }
                return response.json();
            })
            .then(certificados => {
                var certificadosList = document.getElementById("certificados-list");
                certificadosList.innerHTML = "";
                certificados.forEach(certificado => {
                    var li = document.createElement("li");
                    li.textContent = `Nome: ${certificado.nome}, CPF: ${certificado.cpf}, Data de Emissão: ${certificado.dataEmisao}, Data de Vencimento: ${certificado.dataVencimento}`;
                    
                    var btnExcluir = document.createElement("button");
                    btnExcluir.textContent = "Excluir";
                    btnExcluir.addEventListener("click", function() {
                        excluirCertificado(certificado.uuid);
                    });
                    
                    li.appendChild(btnExcluir);
                    certificadosList.appendChild(li);
                });
            })
            .catch(error => {
                console.error("Erro:", error);
            });
        }

        function excluirCertificado(uuid) {
            fetch(`${baseUrl}/${uuid}`, {
                method: "DELETE"
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao excluir certificado: " + response.statusText);
                }
                // Recarregar a lista de certificados após a exclusão
                carregarCertificados();
            })
            .catch(error => {
                console.error("Erro:", error);
            });
        }

        function exibirMensagem(mensagem, tipo) {
            var mensagemDiv = document.getElementById("mensagem");
            mensagemDiv.innerHTML = mensagem;
            mensagemDiv.className = tipo;
        }

        function limparCampos() {
            document.getElementById("arquivoPfx").value = "";
            document.getElementById("senha").value = "";
        }

        carregarCertificados();
    </script>

    <style>
        .success {
            color: green;
        }

        .error {
            color: red;
        }

        #certificados-list {
            list-style: none;
            padding: 0;
        }

        #certificados-list li {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        #certificados-list li button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }

        #certificados-list li button:hover {
            background-color: #d32f2f;
        }
    </style>
</body>
</html>
